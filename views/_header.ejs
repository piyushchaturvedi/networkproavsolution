<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= pageTitle %></title>
  <link rel="stylesheet" href="/css/home.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/all-product.css" />
  <link rel="stylesheet" href="/css/login.css" />
  <link rel="stylesheet" href="/css/details.css" />
  <link rel="stylesheet" href="/css/contact.css" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&display=swap" rel="stylesheet" />

  <!-- Dynamic SEO Meta Tags -->
  <meta name="description" content="<%= settings.metaDescription %>" />
  <meta name="keywords" content="<%= settings.metaKeywords %>" />
  <meta name="author" content="CybersafeTrust" />
  <meta name="robots" content="index, follow" />

  <!-- Open Graph (for social media) - Can also be dynamic if needed -->
  <meta property="og:title" content="<%= settings.metaTitle %>" />
  <meta property="og:description" content="<%= settings.metaDescription %>" />
  <meta property="og:image" content="https://example.com/images/antivirus-banner.jpg" />
  <meta property="og:url" content="https://cybersafetrust.com/" />
  <meta property="og:type" content="website" />

  <!-- Twitter Cards - Can also be dynamic if needed -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="<%= settings.metaTitle %>" />
  <meta name="twitter:description" content="<%= settings.metaDescription %>" />
  <meta name="twitter:image" content="https://example.com/images/twitter-banner.jpg" />
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <link rel="canonical" href="https://cybersafetrust.com/">


</head>
<style>
  /* 1. Set the container to flexbox for proper alignment */
  .products_search_main {
    width: 100%;
    /* margin-left: -35px; */
    display: flex;
    /* ADDED/UPDATED */
    align-items: center;
    /* ADDED/UPDATED: Ensures vertical centering */
  }

  /* 2. Style the input field for merging */
  .products_search_header {
    width: 70%;
    padding-block: 8px;
    padding-inline: 15px;
    border: 1px solid #f04444;
    color: #000000;
    border-radius: 10px 0 0 10px;
    border-right: none;
    /* ADDED/UPDATED: Removes the right border for merging */
    /* Ensure no extra vertical spacing */
    margin-bottom: 0;
  }

  /* 3. Style the button for merging */
  .products_search_submit_btn {
    width: 30%;
    padding-inline: 15px;
    padding-block: 9px;
    border-radius: 0 10px 10px 0;
    border: 1px solid #f04444;
    /* Match input border */
    border-left: none;
    /* ADDED/UPDATED: Removes the left border for merging */
    /* Ensure no extra vertical spacing */
    margin-bottom: 0 !important;
    /* Force removal of any inherited margin */
    height: 38px;
    /* Consistent height with the input field */
    box-sizing: border-box;
    /* Crucial for correct height calculation */
  }
</style>

<body>

  <header class="new-header light-theme-header shadow-sm">
    <div class="container-fluid py-2 border-bottom">
      <div class="row align-items-center justify-content-between">

        <!-- ðŸ”¹ Logo (Left) -->
        <div class="col-12 col-md-4 text-center text-md-start mb-2 mb-md-0">
          <% if (settings.mainLogoUrl) { %>
          <a href="/" class="logo-link d-inline-block">
            <img src="<%= settings.mainLogoUrl %>" alt="NetworkProAVSolution Logo" class="header-logo-img">
          </a>
          <% } else { %>
          <a href="/" class="logo-text fw-bold fs-4">NetworkProAVSolution</a>
          <% } %>
        </div>

        <div class="col-12 col-md-4 text-center text-md-center" style="position: relative;">
          <form action="/products/search" method="GET" class="products_search_main d-inline-flex align-items-center"
            style="position: relative; display: flex; align-items: center; margin-bottom: 0;">

            <input type="text" class="products_search_header" name="query" id="global-search-input"
              placeholder="Search Products Here..." autocomplete="off" />

            <div id="search-loader" style="
                position: absolute; 
                top: 50%; 
                /* Adjust right position based on button size (approx. 90px from the right edge of the whole form) */
                right: 90px; 
                transform: translateY(-50%); 
                color: #f04444;
                display: none;
                pointer-events: none;
                z-index: 1001; 
            ">
              <i class="fa fa-spinner fa-spin"></i>
            </div>
            <button type="submit" class="products_search_submit_btn"
              style="background-color: #ef4444; color: white; border: none; height: 42px;">Search</button>
          </form>

          <div id="search-suggestions-container" style="
              position: absolute; 
              /* FIX: Fixed top value (approx. 40px) to drop it immediately below the search bar */
              top: 40px; 
              left: 50%; 
              transform: translateX(-50%); 
              width: 100%; 
              max-width: 400px; 
              z-index: 1000; 
              display: none;
              border: 1px solid #ddd;
              box-shadow: 0 4px 6px rgba(0,0,0,0.1);
              background-color: white;
              text-align: left;
              border-radius: 0 0 8px 8px;
              overflow: hidden;
          ">
          </div>

        </div>

        <!-- ðŸ”¹ Phone + Cart (Right) -->
        <!-- <div class="col-12 col-md-8 text-center text-md-end">
        <div class="d-inline-flex align-items-center gap-3">
          
          <a href="tel:<%= settings.homePhoneNumber %>" class="text-dark text-decoration-none fw-semibold">
            <i class="fa fa-phone text-success me-2"></i>
            <%= settings.homePhoneNumber %>
          </a>

         
          <a href="/cart" class="text-dark text-decoration-none position-relative fw-semibold">
            <i class="fa fa-shopping-cart fa-lg"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
              <%= cartTotalItems %>
            </span>
            <span class="ms-2">$<%= cartTotalPrice %></span>
          </a>
        </div>
      </div> -->

        <div class="col-12 col-md-4 text-center text-md-end">
          <div class="header_cart_help d-inline-flex align-items-center gap-5">

            <!-- Support (replaces Phone) -->
            <div id="supportBtn"
              class="text-dark text-decoration-none fw-semibold header-support d-flex align-items-center"
              style="cursor:pointer;">
              <!-- <i class="fa-solid fa-headset text-primary me-2"></i> -->
              <img src="/image/24-hours-support.png" />
              <div class="live_supports">
                <span>Live Support</span>
                <p class="click_here">Click Here</p>
              </div>

            </div>

            <!-- Cart -->
            <a href="/cart" class="text-dark text-decoration-none position-relative fw-semibold">
              <i class="fa fa-shopping-cart fa-lg"></i>
              <span class="badge rounded-pill bg-danger">
                <%= cartTotalItems %>
              </span>
              <span class="ms-2">$<%= cartTotalPrice %></span>
            </a>

          </div>
        </div>

      </div>
    </div>

    <!-- ðŸ”¹ Navigation Menu -->
    <!-- === MENU BAR SECTION === -->
    <div class="menu-bar-bg">
      <nav class="navbar navbar-expand-lg navbar-light py-2 custom-menu-bg">
        <div class="container justify-content-center custom-menu-bg">
          <!-- Mobile Toggle -->
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainMenu">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse justify-content-center" id="mainMenu">
            <% 
              // 1. Manually find the specific dynamic pages using expected slugs/titles
              // Assuming slug for About Us is 'about-us'
              const aboutPage = headerPages.find(p => p.slug === 'about-us');
              
              // Assuming slug for Terms & Conditions is 'terms-conditions'
              const termsPage = headerPages.find(p => p.slug === 'terms-conditions' || p.title.toUpperCase().includes('TERMS'));
            %>

            <ul class="navbar-nav gap-3 text-uppercase fw-semibold">

              <li class="nav-item">
                <a href="/" class="nav-link <%= activePage === 'home' ? 'active text-success' : '' %>">HOME</a>
              </li>

              <% if (aboutPage) { %>
              <li class="nav-item">
                <a href="/<%= aboutPage.slug %>"
                  class="nav-link <%= activePage === aboutPage.slug ? 'active text-success' : '' %>">
                  <%= aboutPage.title.toUpperCase() %>
                </a>
              </li>
              <% } %>

              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  CATEGORY
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="/products">All Products</a></li>
                  <li><a class="dropdown-item" href="/products/norton">Norton Antivirus</a></li>
                  <li><a class="dropdown-item" href="/products/mcafee">McAfee Antivirus</a></li>
                  <li><a class="dropdown-item" href="/products/avast">Avast Antivirus</a></li>
                  <li><a class="dropdown-item" href="/products/bitdefender">Bitdefender Antivirus</a></li>
                  <li><a class="dropdown-item" href="/products/avg">AVG Antivirus</a></li>
                  <li><a class="dropdown-item" href="/products/watchdog">Watchdog Antimalware</a></li>
                </ul>
              </li>

              <li class="nav-item">
                <a href="/contact"
                  class="nav-link <%= activePage === 'contact' ? 'active text-success' : '' %>">CONTACT</a>
              </li>
              
              <% if (termsPage) { %>
              <li class="nav-item">
                <a href="/<%= termsPage.slug %>"
                  class="nav-link <%= activePage === termsPage.slug ? 'active text-success' : '' %>">
                  <%= termsPage.title.toUpperCase() %>
                </a>
              </li>
              <% } %>

              <% if (user && user.role === 'admin') { %>
              <li class="nav-item"><a href="/admin/product/list"
                  class="nav-link <%= activePage === 'admin' ? 'active text-success' : '' %>">PRODUCT LIST</a></li>
              <li class="nav-item"><a href="/admin/product/add"
                  class="nav-link <%= activePage === 'add-product' ? 'active text-success' : '' %>">ADD PRODUCT</a></li>
              <li class="nav-item"><a href="/admin/users"
                  class="nav-link <%= activePage === 'users' ? 'active text-success' : '' %>">USERS</a></li>
              <li class="nav-item"><a href="/admin/orders"
                  class="nav-link <%= activePage === 'orders' ? 'active text-success' : '' %>">ORDERS</a></li>
              <li class="nav-item"><a href="/admin/testimonials"
                  class="nav-link <%= activePage === 'testimonials' ? 'active text-success' : '' %>">TESTIMONIALS</a>
              </li>
              <li class="nav-item"><a href="/admin/pages"
                  class="nav-link <%= activePage === 'pages' ? 'active text-success' : '' %>">CMS PAGES</a></li>
              <li class="nav-item"><a href="/admin/contact-messages"
                  class="nav-link <%= activePage === 'contact-messages' ? 'active text-success' : '' %>">MESSAGES</a>
              </li>
              <li class="nav-item"><a href="/admin/settings"
                  class="nav-link <%= activePage === 'settings' ? 'active text-success' : '' %>">SETTINGS</a></li>
              <% } %>

              <% if (user || activePage === 'admin' || activePage === 'login') { %>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  ACCOUNT
                </a>
                <ul class="dropdown-menu">
                  <% if (user) { %>
                  <li><a class="dropdown-item" href="#">My Account (<%= user.username %>)</a></li>
                  <li><a class="dropdown-item" href="/admin/logout">Logout</a></li>
                  <% } else { %>
                  <li><a class="dropdown-item" href="/login">Login</a></li>
                  <% } %>
                </ul>
              </li>
              <% } %>
            </ul>
          </div>
        </div>
      </nav>
    </div>

  </header>
  <script type="text/javascript">
    var Tawk_API = Tawk_API || {},
      Tawk_LoadStart = new Date();
    (function () {
      var s1 = document.createElement("script"),
        s0 = document.getElementsByTagName("script")[0];
      s1.async = true;
      s1.src = 'https://embed.tawk.to/685c654671a033190a6218a0/1iuken7h4';
      s1.charset = 'UTF-8';
      s1.setAttribute('crossorigin', '*');
      s0.parentNode.insertBefore(s1, s0);
    })();

    // Handle button click to show chat
    document.addEventListener("DOMContentLoaded", function () {
      const supportBtn = document.getElementById("supportBtn");

      // --- NEW: Auto-Suggestion Logic (COMPLETE) ---
      const searchInput = document.getElementById('global-search-input');
      const suggestionsContainer = document.getElementById('search-suggestions-container');
      const loader = document.getElementById('search-loader');
      let debounceTimeout;

      if (searchInput && suggestionsContainer && loader) {

        // 1. Renders the fetched product suggestions into the dropdown box
        const renderSuggestions = (suggestions) => {
          suggestionsContainer.innerHTML = '';
          if (suggestions.length === 0) {
            suggestionsContainer.style.display = 'none';
            return;
          }

          suggestions.forEach(product => {
            const item = document.createElement('a');
            item.href = `/product/${product.id}`;
            item.classList.add('suggestion-item');

            // Inline styles for suggestion item appearance
            item.style.cssText =
              'display: flex; align-items: center; padding: 8px 12px; text-decoration: none; color: #333; transition: background-color 0.2s;';
            item.onmouseover = () => {
              item.style.backgroundColor = '#f0f0f0';
            };
            item.onmouseout = () => {
              item.style.backgroundColor = 'white';
            };

            const imgUrl = product.image || '/image/default.png';
            const price = product.price ?
              `<small style="margin-left: auto; color: #ef4444; font-weight: bold;">$${product.price.toFixed(2)}</small>` :
              '';

            item.innerHTML = `
                     <img src="${imgUrl}" alt="${product.name}" style="width: 30px; height: 30px; object-fit: contain; margin-right: 10px; border-radius: 4px; flex-shrink: 0;">
                     <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1;">${product.name}</span>
                     ${price}
                 `;
            suggestionsContainer.appendChild(item);
          });

          suggestionsContainer.style.display = 'block';
        };

        // 2. Fetches suggestions from the backend API
        const fetchSuggestions = async (query) => {
          if (query.length < 2) {
            suggestionsContainer.style.display = 'none';
            loader.style.display = 'none';
            return;
          }

          loader.style.display = 'block'; // SHOW LOADER BEFORE FETCH

          try {
            const response = await fetch(`/api/products/suggest?q=${encodeURIComponent(query)}`);
            if (!response.ok) {
              throw new Error('Failed to fetch suggestions');
            }
            const suggestions = await response.json();
            renderSuggestions(suggestions);

          } catch (error) {
            console.error('Suggestion fetch error:', error);
            suggestionsContainer.style.display = 'none';
          } finally {
            loader.style.display = 'none'; // HIDE LOADER AFTER COMPLETION
          }
        };

        // 3. Event listener for user input (with debounce)
        searchInput.addEventListener('input', (event) => {
          clearTimeout(debounceTimeout);
          const query = event.target.value.trim();
          debounceTimeout = setTimeout(() => {
            fetchSuggestions(query);
          }, 300); // 300ms debounce
        });

        // 4. Hide suggestions when clicking outside
        document.addEventListener('click', (event) => {
          // Use the parent form class to check if click is inside the search area
          if (!event.target.closest('.products_search_main') && !event.target.closest(
              '#search-suggestions-container')) {
            suggestionsContainer.style.display = 'none';
          }
        });

        // 5. Ensure suggestions reappear if search input is focused
        searchInput.addEventListener('focus', (event) => {
          if (event.target.value.trim().length >= 2) {
            // Re-fetch only if the container is currently empty or hidden, and the query is valid
            if (suggestionsContainer.style.display === 'none' || suggestionsContainer.innerHTML === '') {
              fetchSuggestions(event.target.value.trim());
            } else {
              suggestionsContainer.style.display = 'block';
            }
          }
        });
      }

      if (supportBtn) {
        supportBtn.addEventListener("click", function () {
          if (typeof Tawk_API !== "undefined" && Tawk_API.maximize) {
            Tawk_API.maximize(); // Open chat popup
          } else {
            alert("Chat is still loading. Please try again in a moment.");
          }
        });
      }
    });
  </script>
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>